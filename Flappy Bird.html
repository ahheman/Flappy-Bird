<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flappy Bird Final</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }

    #game {
      background-image: url('https://i.postimg.cc/kVq6QDC7/Flux-Dev-A-warmly-lit-whimsical-concept-design-sheet-for-a-Fla-0.jpg');
      background-size: cover;
      background-position: center;
      width: 100vw;
      height: 100vh;
      position: relative;
      overflow: hidden;
    }

    #bird {
      width: 60px;
      height: 60px;
      background-image: url('https://i.postimg.cc/94J90wMw/61-PA9-MNj-x-L.png');
      background-size: contain;
      background-repeat: no-repeat;
      position: absolute;
      top: 200px;
      left: 100px;
      z-index: 2;
    }

    .pipe {
      width: 80px;
      background-image: url('https://i.postimg.cc/ZvyvwfL6/1000078826.png');
      background-size: cover;
      background-repeat: no-repeat;
      position: absolute;
      z-index: 1;
    }

    .pipe-top {
      top: 0;
      transform: rotate(180deg);
    }

    .pipe-bottom {
      bottom: 0;
    }

    #score {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 26px;
      color: white;
      background: rgba(0,0,0,0.5);
      padding: 10px 20px;
      border-radius: 10px;
      z-index: 3;
    }

    #game-over-dialog {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 30px;
      text-align: center;
      border-radius: 10px;
      display: none;
      z-index: 4;
    }

    #retry-btn {
      margin-top: 15px;
      padding: 10px 20px;
      background-color: white;
      color: black;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }

    #start-message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 36px;
      color: #fff;
      font-weight: bold;
      animation: pulse 1.5s infinite;
      background: rgba(0, 0, 0, 0.5);
      padding: 20px 30px;
      border-radius: 15px;
      z-index: 3;
    }

    @keyframes pulse {
      0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
      50% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.7; }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }

    .sparkle {
      position: absolute;
      width: 10px;
      height: 10px;
      background: yellow;
      border-radius: 50%;
      animation: sparkle 1s ease-out forwards;
      pointer-events: none;
      z-index: 10;
    }

    @keyframes sparkle {
      0% { transform: scale(1); opacity: 1; }
      100% { transform: scale(2); opacity: 0; }
    }
  </style>
</head>
<body>
  <div id="game">
    <div id="bird"></div>
    <div id="score">Score: 0</div>
    <div id="start-message">Start the Game</div>

    <div id="game-over-dialog">
      <div>Game Over</div>
      <div id="final-score">Score: 0</div>
      <button id="retry-btn">Retry</button>
    </div>

    <audio id="music" src="https://www.bensound.com/bensound-music/bensound-sunny.mp3" loop></audio>
  </div>

  <script>
    const bird = document.getElementById('bird');
    const game = document.getElementById('game');
    const scoreDisplay = document.getElementById('score');
    const gameOverDialog = document.getElementById('game-over-dialog');
    const retryButton = document.getElementById('retry-btn');
    const startMessage = document.getElementById('start-message');
    const finalScoreDisplay = document.getElementById('final-score');
    const music = document.getElementById('music');

    let birdY = 200;
    let velocity = 0;
    const gravity = 0.5;
    let isGameOver = false;
    let isGameStarted = false;
    let score = 0;
    let pipes = [];
    let pipeInterval;
    let pipeSeed = [];
    let pipeIndex = 0;

    function generateSeed() {
      pipeSeed = [];
      const totalPipes = 50;
      for (let i = 0; i < totalPipes; i++) {
        pipeSeed.push(Math.floor(Math.random() * 250) + 50);
      }
    }

    function resetGame() {
      birdY = 200;
      velocity = 0;
      score = 0;
      pipeIndex = 0;
      isGameOver = false;
      isGameStarted = false;
      finalScoreDisplay.innerText = "Score: 0";
      scoreDisplay.innerText = "Score: 0";
      bird.style.top = birdY + 'px';
      gameOverDialog.style.display = 'none';
      startMessage.style.display = 'block';
      pipes.forEach(p => {
        p.top.remove();
        p.bottom.remove();
      });
      pipes = [];
      generateSeed();
    }

    function startGame() {
      if (isGameStarted) return;
      isGameStarted = true;
      music.play();
      startMessage.style.display = 'none';
      requestAnimationFrame(gameLoop);
      pipeInterval = setInterval(() => {
        if (!isGameOver && isGameStarted) createPipe();
      }, 2000);
    }

    function createPipe() {
      const gap = 150;
      const pipeTopHeight = pipeSeed[pipeIndex % pipeSeed.length];
      pipeIndex++;
      const pipeBottomHeight = game.clientHeight - pipeTopHeight - gap;
      const pipeX = game.clientWidth;

      const pipeTop = document.createElement('div');
      pipeTop.classList.add('pipe', 'pipe-top');
      pipeTop.style.height = pipeTopHeight + 'px';
      pipeTop.style.left = pipeX + 'px';

      const pipeBottom = document.createElement('div');
      pipeBottom.classList.add('pipe', 'pipe-bottom');
      pipeBottom.style.height = pipeBottomHeight + 'px';
      pipeBottom.style.left = pipeX + 'px';

      game.appendChild(pipeTop);
      game.appendChild(pipeBottom);
      pipes.push({ top: pipeTop, bottom: pipeBottom });
    }

    function createSparkle(x, y) {
      const sparkle = document.createElement('div');
      sparkle.classList.add('sparkle');
      sparkle.style.left = x + 'px';
      sparkle.style.top = y + 'px';
      game.appendChild(sparkle);
      setTimeout(() => sparkle.remove(), 1000);
    }

    function gameLoop() {
      if (isGameOver || !isGameStarted) return;

      velocity += gravity;
      birdY += velocity;

      if (birdY + 60 >= game.clientHeight || birdY <= 0) {
        endGame();
        return;
      }

      bird.style.top = birdY + 'px';

      for (let i = pipes.length - 1; i >= 0; i--) {
        const pipe = pipes[i];
        let pipeLeft = parseInt(pipe.top.style.left);
        pipeLeft -= 2;
        pipe.top.style.left = pipeLeft + 'px';
        pipe.bottom.style.left = pipeLeft + 'px';

        if (pipeLeft + 80 < 0) {
          pipe.top.remove();
          pipe.bottom.remove();
          pipes.splice(i, 1);
          continue;
        }

        if (pipeLeft + 80 === 100) {
          score++;
          scoreDisplay.innerText = "Score: " + score;
          createSparkle(140, birdY + 20);
        }

        if (
          pipeLeft < 140 && pipeLeft + 80 > 100 &&
          (
            birdY < pipe.top.offsetHeight ||
            birdY + 60 > game.clientHeight - pipe.bottom.offsetHeight
          )
        ) {
          endGame();
        }
      }

      requestAnimationFrame(gameLoop);
    }

    function endGame() {
      isGameOver = true;
      clearInterval(pipeInterval);
      music.pause();
      music.currentTime = 0;
      finalScoreDisplay.innerText = "Score: " + score;
      gameOverDialog.style.display = 'block';
    }

    document.addEventListener('keydown', () => {
      if (!isGameOver && isGameStarted) velocity = -8;
    });

    document.addEventListener('click', () => {
      if (!isGameStarted) {
        startGame();
      } else if (!isGameOver) {
        velocity = -8;
      }
    });

    retryButton.addEventListener('click', () => {
      resetGame();
    });

    resetGame();
  </script>
</body>
</html>
